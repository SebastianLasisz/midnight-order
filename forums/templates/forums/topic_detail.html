{% extends "creation/base.html" %}
{% block content %}
    {% load i18n %}
    {% block breadcrumb %}
        <ol class="breadcrumb">
            <li><a href="{% url 'forums:overview' %}">{% trans "Forums" %}</a></li>
            <li>
                <a href="{% url 'forums:overview' %}#{{ topic.forum.category.id }}">{{ topic.forum.category.name }}</a>
            </li>
            <li><a href="{% url 'forums:forum' topic.forum.id %}">{{ topic.forum.name }}</a></li>
            <li class="active">{{ topic.name }}</li>
        </ol>
    {% endblock %}
    {% if not user.is_authenticated  or user.groups.all.0.name == "Initiate" %}
        {% if topic.forum.category.name == "Public Forums" %}
            <table class="table table-bordered">
                {% for post in topic.posts.all %}
                    <div class="row">
                        <tr>
                            <td width="100">
                                <div class="span3">
                                    <center>
                                        <b><strong><i>{{ post.user.user.username }}</i></strong></b>
                                    </center>

                                    <center><img src="/media/{{ post.user.avatar }}"
                                                 onerror="this.src='/media/img/logo3.jpg';"
                                                 alt="" width=100 height=100 class="img-rounded"
                                                 alt="avatar"></center>
                                    {% if post.user.user.groups.all.1.name %}
                                        <p>
                                        <center>
                                            <font color="#87ceeb"><strong><i>{{ post.user.user.groups.all.1.name }}</i></strong></font>
                                        </center></p>
                                    {% else %}
                                        <p>
                                        <center>
                                            <strong><i>{{ post.user.user.groups.all.0.name }}</i></strong>
                                        </center></p>
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                <div class="span7">
                                    <div>
                                        {{ post.body|safe|linebreaks|urlize }}
                                    </div>
                                    <div>
                                        <p>--------------------</p>
                                        {{ post.user.signature }}
                                    </div>
                                    <div style="clear: both;"></div>
                                </div>
                                <div class="span2">
                                    <p class="pull-right">
                                        <small><a href="#{{ forloop.counter }}"
                                                  name="{{ forloop.counter }}">#{{ forloop.counter }}</a>
                                        </small>
                                    </p>
                                    <p class="pull-right">
                                        <small>{{ post.created }}</small>
                                    </p>
                                </div>
                            </td>
                        </tr>
                    </div>
                {% endfor %}
            </table>
        {% endif %}
    {% else %}
        {% if user.groups.all.0.name == "Officer" or user.groups.all.0.name == "Leader" %}
            {% if topic.forum.name == "Officer's Chat" and  user.groups.all.0.name == "Leader" %}
            {% else %}
                <table class="table table-bordered">
                    {% for post in topic.posts.all %}
                        <div class="row">
                            <tr>
                                <td width="100">
                                    <div class="span3">
                                        <center>
                                            <b><strong><i>{{ post.user.user.username }}</i></strong></b>
                                        </center>

                                        <center><img src="/media/{{ post.user.avatar }}"
                                                     onerror="this.src='/media/img/logo3.jpg';"
                                                     alt="" width=100 height=100 class="img-rounded"
                                                     alt="avatar"></center>
                                        {% if post.user.user.groups.all.1.name %}
                                            <p>
                                            <center>
                                                <font color="#87ceeb"><strong><i>{{ post.user.user.groups.all.1.name }}</i></strong></font>
                                            </center></p>
                                        {% else %}
                                            <p>
                                            <center>
                                                <strong><i>{{ post.user.user.groups.all.0.name }}</i></strong>
                                            </center></p>
                                        {% endif %}
                                    </div>
                                </td>
                                <td>
                                    <div class="span7">
                                        <div>
                                            {{ post.body|safe|linebreaks|urlize }}
                                        </div>
                                        <div>
                                            <p>--------------------</p>
                                            {{ post.user.signature }}
                                        </div>
                                        <div style="clear: both;"></div>
                                    </div>
                                    <div class="span2">
                                        <p class="pull-right">
                                            <small><a href="#{{ forloop.counter }}"
                                                      name="{{ forloop.counter }}">#{{ forloop.counter }}</a>
                                            </small>
                                        </p>
                                        <p class="pull-right">
                                            <small>{{ post.created }}</small>
                                        </p>
                                    </div>
                                </td>
                            </tr>
                        </div>
                    {% endfor %}
                </table>
            {% endif %}
        {% else %}
            {% if user.groups.all.0.name != "Officer" and user.groups.all.0.name != "Leader" and topic.forum.category.name != "Forum: Restricted forums" %}
                <table class="table table-bordered">
                    {% for post in topic.posts.all %}
                        <div class="row">
                            <tr>
                                <td width="100">
                                    <div class="span3">
                                        <center>
                                            <b><strong><i>{{ post.user.user.username }}</i></strong></b>
                                        </center>

                                        <center><img src="/media/{{ post.user.avatar }}"
                                                     onerror="this.src='/media/img/logo3.jpg';"
                                                     alt="" width=100 height=100 class="img-rounded"
                                                     alt="avatar"></center>
                                        {% if post.user.user.groups.all.1.name %}
                                            <p>
                                            <center>
                                                <font color="#87ceeb"><strong><i>{{ post.user.user.groups.all.1.name }}</i></strong></font>
                                            </center></p>
                                        {% else %}
                                            <p>
                                            <center>
                                                <strong><i>{{ post.user.user.groups.all.0.name }}</i></strong>
                                            </center></p>
                                        {% endif %}
                                    </div>
                                </td>
                                <td>
                                    <div class="span7">
                                        <div>
                                            {{ post.body|safe|linebreaks|urlize }}
                                        </div>
                                        <div>
                                            <p>--------------------</p>
                                            {{ post.user.signature }}
                                        </div>
                                        <div style="clear: both;"></div>
                                    </div>
                                    <div class="span2">
                                        <p class="pull-right">
                                            <small><a href="#{{ forloop.counter }}"
                                                      name="{{ forloop.counter }}">#{{ forloop.counter }}</a>
                                            </small>
                                        </p>
                                        <p class="pull-right">
                                            <small>{{ post.created }}</small>
                                        </p>
                                    </div>
                                </td>
                            </tr>
                        </div>
                    {% endfor %}
                </table>
            {% endif %}
        {% endif %}
    {% endif %}
    <div class="row">
        <div class="span12">
            {% if not topic.is_closed or user.groups.all.0.name == "Officer" %}
                {% if not user.is_authenticated  or user.groups.all.0.name == "Initiate" %}
                    {% if topic.forum.category.name == "Public Forums" %}
                        {% if not topic.forum.is_closed or user.is_staff %}
                            {% if topic.forum.name == "Leader's Chat" and  user.groups.all.0.name == "Leader" %}
                                <p><a href="{% url 'forums:post_create' topic.id %}"
                                      class="btn btn-primary">{% trans "Create post" %}</a></p>
                            {% else %}
                                <p><a href="{% url 'forums:post_create' topic.id %}"
                                      class="btn btn-primary">{% trans "Create post" %}</a></p>
                            {% endif %}
                        {% else %}
                            <p>{% trans "This forum is closed, only admins can create and post here." %}
                        {% endif %}
                    {% endif %}
                {% else %}
                {% if user.groups.all.0.name == "Officer" or user.groups.all.0.name == "Leader" %}
                    {% if topic.forum.name == "Officer's Chat" and  user.groups.all.0.name == "Leader" %}
                    {% else %}
                        {% if not topic.forum.is_closed or user.is_staff %}
                            {% if topic.forum.name == "Leader's Chat" and  user.groups.all.0.name == "Leader" %}
                                <p><a href="{% url 'forums:post_create' topic.id %}"
                                      class="btn btn-primary">{% trans "Create post" %}</a></p>
                            {% else %}
                                <p><a href="{% url 'forums:post_create' topic.id %}"
                                      class="btn btn-primary">{% trans "Create post" %}</a></p>
                            {% endif %}
                        {% else %}
                            <p>{% trans "This forum is closed, only admins can create and post here." %}
                        {% endif %}
                    {% endif %}
                {% else %}
                {% if user.groups.all.0.name != "Officer" and user.groups.all.0.name != "Leader" and topic.forum.category.name != "Forum: Restricted forums" %}
                    {% if not topic.forum.is_closed or user.is_staff %}
                        <p><a href="{% url 'forums:post_create' topic.id %}"
                              class="btn btn-primary">{% trans "Create post" %}</a></p>
                    {% else %}
                        <p>{% trans "This forum is closed, only admins can create and post here." %}
                    {% endif %}
                {% endif %}
                {% endif %}
                {% endif %}
            {% else %}
                <b><p style="color:red" class="center">This topic is closed.</p></b>
            {% endif %}
            {% if  user.groups.all.0.name == "Officer" %}
                {% if topic.is_closed %}
                    <p><a href="{% url 'forums:lock_topic' topic.id %}"
                          class="btn btn-primary">{% trans "Unlock topic" %}</a></p>
                {% else %}
                    <p><a href="{% url 'forums:lock_topic' topic.id %}"
                          class="btn btn-primary">{% trans "Lock topic" %}</a></p>
                {% endif %}
            {% endif %}
        </div>
    </div>
{% endblock %}